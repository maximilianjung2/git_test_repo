<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kursübersicht – Sportvereinigung</title>

<style>
  :root {
    --blue: #00458a;
    --blue-dark: #003062;
    --red: #e3322c;
    --red-dark: #c62822;
    --bg: #f2f2f2;
    --card: #ffffff;
    --border: #d9dde2;
    --muted: #555;
    --radius: 10px;
    font-family: "Helvetica Neue", Arial, sans-serif;
  }

  body {
    margin: 0;
    padding: 24px;
    background: var(--bg);
    color: #222;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
  }

  header {
    margin-bottom: 16px;
  }

  header h1 {
    margin: 0 0 4px 0;
    color: var(--blue-dark);
    font-size: 24px;
    font-weight: 700;
  }

  header .subtitle {
    font-size: 13px;
    color: var(--muted);
  }

  .card {
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    padding: 16px 16px 20px;
    border-top: 4px solid var(--blue);
  }

  /* Filter + Suche */
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: flex-end;
    margin-bottom: 14px;
  }

  .field {
    display: flex;
    flex-direction: column;
    min-width: 160px;
  }

  .field.large {
    flex: 1;
    min-width: 220px;
  }

  label.small {
    font-size: 12px;
    color: var(--muted);
    margin-bottom: 4px;
    font-weight: 600;
  }

  input[type="search"],
  select {
    padding: 9px 10px;
    border-radius: 6px;
    border: 2px solid var(--blue);
    font-size: 14px;
    outline: none;
    background: #fff;
  }

  input[type="search"]:focus,
  select:focus {
    box-shadow: 0 0 0 2px rgba(0,69,138,0.2);
  }

  .actions {
    margin-left: auto;
    display: flex;
    gap: 8px;
  }

  .btn {
    padding: 9px 14px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    text-decoration: none;
  }

  .btn-primary {
    background: var(--red);
    color: #fff;
  }

  .btn-primary:hover {
    background: var(--red-dark);
  }

  .btn-outline {
    background: #ffffff;
    border: 2px solid var(--blue);
    color: var(--blue);
  }

  .btn-outline:hover {
    background: var(--blue);
    color: #ffffff;
  }

  /* Tabelle */
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }

  thead th {
    padding: 12px 14px;
    text-align: left;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 0.03em;
    border-bottom: 2px solid var(--blue);
    color: #ffffff;
    background: linear-gradient(90deg,var(--blue-dark),var(--blue));
  }

  tbody td {
    padding: 10px 14px;
    border-bottom: 1px solid #e4e8ee;
    vertical-align: top;
  }

  tbody tr:nth-child(even) {
    background: #fafbff;
  }

  tbody tr:hover {
    background: #f2f6ff;
  }

  .small {
    font-size: 13px;
    color: var(--muted);
  }

  a.link {
    color: var(--red);
    text-decoration: none;
    font-weight: 600;
    word-break: break-all;
  }

  a.link:hover {
    color: var(--red-dark);
    text-decoration: underline;
  }

  .badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 999px;
    background: #ffecec;
    color: var(--red-dark);
    font-size: 12px;
    font-weight: 600;
    border: 1px solid #f3c0c0;
    margin-top: 4px;
  }

  .no-results {
    padding: 15px;
    text-align: center;
    color: var(--muted);
    font-size: 14px;
  }

  footer {
    margin-top: 10px;
    font-size: 12px;
    color: var(--muted);
  }

  /* Mobile Darstellung: Cards statt klassischer Tabelle */
  @media (max-width: 900px) {
    thead {
      display: none;
    }
    table,
    tbody,
    tr,
    td {
      display: block;
      width: 100%;
    }
    tr {
      background: #ffffff;
      border-radius: 10px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.06);
      margin-bottom: 12px;
      border: 1px solid var(--border);
    }
    td {
      border-bottom: none;
      padding: 8px 12px;
    }
    td::before {
      content: attr(data-label);
      font-weight: 700;
      display: block;
      margin-bottom: 3px;
      color: var(--blue-dark);
      font-size: 12px;
      text-transform: uppercase;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Kursübersicht</h1>
      <div class="subtitle">Suche &amp; Filter · Datenquelle: <code>courses.json</code></div>
    </header>

    <div class="card">
      <div class="controls" aria-label="Filter und Suche">
        <div class="field large">
          <label class="small" for="q">Suche (global)</label>
          <input id="q" type="search" placeholder="Suche nach Kurs, Übungsleiter, Ort, Zeit ..." aria-label="Suche">
        </div>

        <div class="field">
          <label class="small" for="filter-instructor">Übungsleiter</label>
          <select id="filter-instructor">
            <option value="">Alle</option>
          </select>
        </div>

        <div class="field">
          <label class="small" for="filter-weekday">Wochentag</label>
          <select id="filter-weekday">
            <option value="">Alle</option>
          </select>
        </div>

        <div class="field">
          <label class="small" for="filter-wo">Ort</label>
          <select id="filter-wo">
            <option value="">Alle</option>
          </select>
        </div>

        <div class="field">
          <label class="small" for="filter-kurs">Kursname</label>
          <select id="filter-kurs">
            <option value="">Alle</option>
          </select>
        </div>

        <div class="field">
          <label class="small" for="filter-category">Kategorie</label>
          <select id="filter-category">
            <option value="">Alle</option>
          </select>
        </div>

        <div class="actions">
          <button id="reset" class="btn btn-outline" type="button">Zurücksetzen</button>
          <button id="exportCsv" class="btn btn-primary" type="button">CSV Export</button>
        </div>
      </div>

      <table id="kurs-table" aria-live="polite">
        <thead>
          <tr>
            <th>Übungsleiter</th>
            <th>Kurs</th>
            <th>Kategorie</th>
            <th>Wann</th>
            <th>Wo</th>
            <th>Kontakt</th>
            <th>Link</th>
          </tr>
        </thead>
        <tbody>
          <!-- wird per JS gefüllt -->
        </tbody>
      </table>

      <div id="no-results" class="no-results" style="display:none;">
        Keine Einträge gefunden. Bitte Filter/Suche anpassen.
      </div>
    </div>

    <footer>
      Pflege: <code>courses.json</code> bearbeiten (z.&nbsp;B. mit VS&nbsp;Code). Felder: instructor, kontakt, kurs, kurzbeschreibung, wann, wo, link, weekday, category.
    </footer>
  </div>

<script>
(async function() {
  let data = [];
  try {
    const resp = await fetch('courses.json');
    data = await resp.json();
  } catch (e) {
    console.error('Fehler beim Laden von courses.json:', e);
  }

  const $tbody = document.querySelector('#kurs-table tbody');
  const $noResults = document.getElementById('no-results');

  const $q = document.getElementById('q');
  const $fi = document.getElementById('filter-instructor');
  const $fw = document.getElementById('filter-weekday');
  const $fwo = document.getElementById('filter-wo');
  const $fk = document.getElementById('filter-kurs');
  const $fc = document.getElementById('filter-category');
  const $reset = document.getElementById('reset');
  const $export = document.getElementById('exportCsv');

  const uniqSorted = arr =>
    Array.from(new Set(arr.filter(Boolean).map(s => s.toString().trim())))
      .sort((a, b) => a.localeCompare(b, 'de'));

  const instructors = uniqSorted(data.map(d => d.instructor));
  const weekdays   = uniqSorted(data.map(d => d.weekday));
  const wos        = uniqSorted(data.map(d => d.wo));
  const kurse      = uniqSorted(data.map(d => d.kurs));
  const cats       = uniqSorted(data.map(d => d.category));

  function fillSelect(sel, values) {
    values.forEach(v => {
      const opt = document.createElement('option');
      opt.value = v;
      opt.textContent = v;
      sel.appendChild(opt);
    });
  }

  fillSelect($fi, instructors);
  fillSelect($fw, weekdays);
  fillSelect($fwo, wos);
  fillSelect($fk, kurse);
  fillSelect($fc, cats);

  function escapeHtml(s) {
    return String(s).replace(/[&<>"']/g, m => ({
      '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
    }[m]));
  }

  function renderRows(rows) {
    $tbody.innerHTML = '';
    if (!rows.length) {
      $noResults.style.display = 'block';
      document.getElementById('kurs-table').style.display = 'none';
      return;
    }
    $noResults.style.display = 'none';
    document.getElementById('kurs-table').style.display = '';

    rows.forEach(r => {
      const tr = document.createElement('tr');
      const linkHtml = r.link
        ? `<a class="link" href="${escapeHtml(r.link)}" target="_blank" rel="noopener noreferrer">Info</a>`
        : '';

      tr.innerHTML = `
        <td data-label="Übungsleiter">${escapeHtml(r.instructor || '')}</td>
        <td data-label="Kurs"><strong>${escapeHtml(r.kurs || '')}</strong></td>
        <td data-label="Kategorie"><span class="badge">${escapeHtml(r.category || '')}</span></td>
        <td data-label="Wann" class="small">${escapeHtml(r.wann || '')}</td>
        <td data-label="Wo" class="small">${escapeHtml(r.wo || '')}</td>
        <td data-label="Kontakt" class="small">${escapeHtml(r.kontakt || '')}</td>
        <td data-label="Link">${linkHtml}</td>
      `;
      $tbody.appendChild(tr);
    });
  }

  function applyFilters() {
    const q  = $q.value.trim().toLowerCase();
    const fi = $fi.value;
    const fw = $fw.value;
    const fwo = $fwo.value;
    const fk = $fk.value;
    const fc = $fc.value;

    const rows = data.filter(d => {
      const hay = [
        d.instructor, d.kurs, d.kurzbeschreibung,
        d.wann, d.wo, d.link, d.category, d.weekday
      ].filter(Boolean).join(' ').toLowerCase();

      if (q && !hay.includes(q)) return false;
      if (fi && d.instructor !== fi) return false;
      if (fw && d.weekday !== fw) return false;
      if (fwo && d.wo !== fwo) return false;
      if (fk && d.kurs !== fk) return false;
      if (fc && d.category !== fc) return false;
      return true;
    });

    renderRows(rows);
    return rows;
  }

  [$q, $fi, $fw, $fwo, $fk, $fc].forEach(el => {
    el.addEventListener('input', applyFilters);
    el.addEventListener('change', applyFilters);
  });

  $reset.addEventListener('click', () => {
    $q.value = '';
    $fi.value = '';
    $fw.value = '';
    $fwo.value = '';
    $fk.value = '';
    $fc.value = '';
    applyFilters();
  });

  $export.addEventListener('click', () => {
    const rows = applyFilters();
    if (!rows.length) {
      alert('Keine Daten zum Exportieren.');
      return;
    }
    const cols = ['instructor','kurs','category','wann','wo','kontakt','link','weekday'];
    const csv = [cols.join(',')].concat(
      rows.map(r => cols.map(c => `"${(r[c] || '').toString().replace(/"/g,'""')}"`).join(','))
    ).join('\n');

    const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'kurse_export.csv';
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(() => URL.revokeObjectURL(url), 3000);
  });

  // Initiales Rendern
  renderRows(data);
  })();
</script>
</body>
</html>
